<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ark Pioneer Sixth Form Dashboard</title>
  <!-- Firebase v9 compat scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <style>
    body { font-family: Georgia, serif; margin:0; background:#f4f4f4; }
    header {
      position: fixed; top:0; left:0; right:0;
      background:#0d1d5f; padding:12px; text-align:center;
      color:white; z-index:1000;
    }
    header .sixth { font-weight:bold; font-style:italic; }
    header .dashboard { color:red; font-weight:bold; }
    main { margin-top:80px; padding:20px; }
    #loginBox, #logoutBox { margin:10px 0; }
    .calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:5px; }
    .day { background:white; padding:5px; min-height:60px; position:relative; }
    .date { font-weight:bold; }
    .event { padding:2px 4px; border-radius:4px; margin:2px 0; color:white; font-size:12px; position:relative; }
    .event .deleteBtn { position:absolute; right:2px; top:2px; cursor:pointer; font-weight:bold; display:none; }
    .admin .event .deleteBtn { display:inline; }
    .barChart { display:flex; align-items:flex-end; height:300px; gap:20px; margin-top:20px; }
    .bar { flex:1; display:flex; align-items:flex-end; justify-content:center; position:relative; }
    .barFill { width:60px; }
    .barLabel { position:absolute; bottom:0; color:white; font-weight:bold; writing-mode: vertical-rl; transform: rotate(180deg); }
  </style>
</head>
<body>
<header>
  Ark Pioneer <span class="sixth">Sixth Form</span> <span class="dashboard">Dashboard</span>
</header>

<main>
  <!-- Login -->
  <div id="loginBox">
    <input type="password" id="adminPass" placeholder="Enter admin password">
    <button onclick="login()">Login</button>
  </div>
  <div id="logoutBox" style="display:none;">
    <span id="loginStatus"></span>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- Calendar -->
  <h2>Calendar - September 2025</h2>
  <div id="calendar" class="calendar"></div>
  <button onclick="showAddEvent()">Add Event</button>
  <div id="eventForm" style="display:none; margin-top:10px;">
    <input type="text" id="eventTitle" placeholder="Event title">
    <input type="number" id="eventDay" min="1" max="30" placeholder="Day">
    <div>
      <label><input type="checkbox" value="Oxford">Oxford</label>
      <label><input type="checkbox" value="Edinburgh">Edinburgh</label>
      <label><input type="checkbox" value="Manchester">Manchester</label>
      <label><input type="checkbox" value="Warwick">Warwick</label>
    </div>
    <button onclick="addEvent()">Save</button>
  </div>

  <!-- Shoutouts -->
  <div id="shoutouts">
    <h2>Shoutouts</h2>
    <input type="text" id="shoutInput" placeholder="Write shoutout...">
    <button onclick="addShoutout()">Add</button>
    <ul id="shoutList"></ul>
  </div>

  <!-- Bar chart -->
  <h2>University Applications</h2>
  <div class="barChart" id="barChart"></div>
</main>

<script>
  // Firebase config & init
  const firebaseConfig = {
    apiKey: "AIzaSyAbge0io2zDFsgPTgyJ8cgzfGsegqeF19w",
    authDomain: "piosf-7ab81.firebaseapp.com",
    databaseURL: "https://piosf-7ab81-default-rtdb.firebaseio.com",
    projectId: "piosf-7ab81",
    storageBucket: "piosf-7ab81.appspot.com",
    messagingSenderId: "198847746183",
    appId: "1:198847746183:web:bbb2ab9f9c4f3657ea6822"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Dashboard data
  let isAdmin = false;
  let events = [];
  let shoutouts = [];
  let uniCounts = {Oxford:0, Edinburgh:0, Manchester:0, Warwick:0};
  let uniColors = {Oxford:'blue', Edinburgh:'red', Manchester:'deeppink', Warwick:'purple'};

  // Login/logout
  function login() {
    const pass = document.getElementById('adminPass').value;
    if(pass==='admin123'){
      isAdmin=true;
      document.body.classList.add('admin');
      document.getElementById('loginBox').style.display='none';
      document.getElementById('logoutBox').style.display='block';
      document.getElementById('loginStatus').textContent='Logged in as Teacher/Admin';
    } else alert('Wrong password');
    document.getElementById('adminPass').value='';
  }
  function logout() {
    isAdmin=false;
    document.body.classList.remove('admin');
    document.getElementById('loginBox').style.display='block';
    document.getElementById('logoutBox').style.display='none';
    document.getElementById('adminPass').value='';
  }

  // Calendar
  function renderCalendar(){
    const cal = document.getElementById('calendar');
    cal.innerHTML='';
    for(let i=1;i<=30;i++){
      const d = document.createElement('div'); d.className='day';
      d.innerHTML=`<div class="date">${i}</div>`;
      events.filter(e=>e.day===i).forEach(e=>{
        e.unis.forEach(u=>{
          const ev=document.createElement('div'); ev.className='event';
          ev.textContent=e.title+' ('+u+')'; ev.style.background=uniColors[u];
          if(isAdmin){
            const x=document.createElement('span'); x.textContent='Ã—';
            x.className='deleteBtn';
            x.onclick=()=>{ events.splice(events.indexOf(e),1); renderCalendar(); };
            ev.appendChild(x);
          }
          d.appendChild(ev);
        });
      });
      cal.appendChild(d);
    }
  }
  function showAddEvent(){ document.getElementById('eventForm').style.display='block'; }
  function addEvent(){
    const title=document.getElementById('eventTitle').value;
    const day=parseInt(document.getElementById('eventDay').value);
    const unis=[...document.querySelectorAll('#eventForm input[type=checkbox]:checked')].map(cb=>cb.value);
    if(!title||!day||unis.length===0) return alert('Fill all fields');
    events.push({day,title,unis});
    renderCalendar();
  }

  // Shoutouts
  function addShoutout(){
    const s=document.getElementById('shoutInput').value;
    if(!s) return;
    shoutouts.push(s);
    renderShoutouts();
    document.getElementById('shoutInput').value='';
  }
  function renderShoutouts(){
    const list=document.getElementById('shoutList'); list.innerHTML='';
    shoutouts.forEach(s=>{
      const li=document.createElement('li'); li.textContent=s; list.appendChild(li);
    });
  }

  // Bar chart
  function renderBars(){
    const bc=document.getElementById('barChart'); bc.innerHTML='';
    for(const uni in uniCounts){
      const bar=document.createElement('div'); bar.className='bar';
      const fill=document.createElement('div'); fill.className='barFill';
      fill.style.height=(uniCounts[uni]*40)+'px'; fill.style.background=uniColors[uni];
      const label=document.createElement('div'); label.className='barLabel'; label.textContent=uni;
      bar.appendChild(fill); bar.appendChild(label);
      bc.appendChild(bar);
    }
  }

  // Initial render
  renderCalendar();
  renderShoutouts();
  renderBars();
</script>
</body>
</html>
