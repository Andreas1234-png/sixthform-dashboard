<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ark Pioneer Sixth Form Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Aptos:wght@400;700&display=swap');

body { margin:0; font-family:'Aptos',sans-serif; background:#f4f4f4; }
header { position:fixed; top:0; left:0; right:0; background:#0d1d5f; color:white; text-align:center; padding:20px; font-family:Georgia, serif; font-size:28px; z-index:1000; }
header .sixth { font-weight:bold; font-style:italic; }
header .dashboard { color:pink; font-weight:bold; font-size:1.2em; }
main { display:flex; margin-top:100px; gap:10px; padding:10px; }

.column { flex:1; background:#fff; border-radius:6px; padding:10px; max-height:80vh; display:flex; flex-direction:column; overflow:hidden; }
.column h2 { margin-top:0; }

#leftColumn .calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:5px; margin-top:10px; flex:1; overflow-y:auto; }
.day { background:#e0f7e0; border-radius:4px; min-height:60px; position:relative; padding:2px; }
.date { font-weight:bold; }
.event { font-size:12px; padding:2px 4px; border-radius:4px; margin:2px 0; color:white; position:relative; }

#middleColumn { overflow:hidden; }
#shoutList { overflow-y:auto; flex:1; padding-right:5px; }
.shoutoutBox { background:#4CAF50; color:white; margin-bottom:5px; padding:5px 8px; border-radius:4px; }

.barChart { display:flex; align-items:flex-end; height:300px; gap:20px; margin-top:10px; flex:1; }
.bar { flex:1; display:flex; align-items:flex-end; justify-content:center; position:relative; }
.barFill { width:60px; }
.barLabel { position:absolute; bottom:0; color:white; font-weight:bold; writing-mode: vertical-rl; transform: rotate(180deg); }

button, input, select { margin:3px 0; padding:5px; }
</style>
</head>
<body>
<header>
  Ark Pioneer <span class="sixth">Sixth Form</span> <span class="dashboard">Dashboard</span>
</header>

<main>
  <!-- Left: Calendar -->
  <div class="column" id="leftColumn">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <button onclick="prevMonth()">◀</button>
      <span id="currentMonth"></span>
      <button onclick="nextMonth()">▶</button>
    </div>
    <div id="calendar" class="calendar"></div>
    <button id="addEventBtn" style="display:none;" onclick="showAddEvent()">Add Event</button>
    <div id="eventForm" style="display:none; margin-top:5px;">
      <input type="text" id="eventTitle" placeholder="Event title"><br>
      <input type="number" id="eventDay" placeholder="Day of month" min="1" max="31"><br>
      <div>
        <label><input type="checkbox" value="Oxford">Oxford</label>
        <label><input type="checkbox" value="Edinburgh">Edinburgh</label>
        <label><input type="checkbox" value="Manchester">Manchester</label>
        <label><input type="checkbox" value="Warwick">Warwick</label>
      </div>
      <button onclick="addEvent()">Save Event</button>
    </div>
  </div>

  <!-- Middle: Shoutouts -->
  <div class="column" id="middleColumn">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h2>Recent Shoutouts</h2>
      <button id="addShoutBtn" style="display:none;" onclick="showAddShout()">Add Shoutout</button>
    </div>
    <div id="shoutList"></div>
    <div id="shoutForm" style="display:none; margin-top:5px;">
      <select id="shoutStudent">
        <option>Alice</option>
        <option>Bob</option>
        <option>Charlie</option>
        <option>Diana</option>
      </select><br>
      <input type="text" id="shoutReason" placeholder="Reason" required><br>
      <input type="text" id="shoutInitials" placeholder="Teacher initials" maxlength="3" required><br>
      <button onclick="addShoutout()">Save Shoutout</button>
    </div>
  </div>

  <!-- Right: Uni Bar Chart -->
  <div class="column" id="rightColumn">
    <h2>University Challenge</h2>
    <div class="barChart" id="barChart"></div>
  </div>
</main>

<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Admin login
let isAdmin=false;
function loginAdmin(){
  const pass=prompt("Enter admin password:");
  if(pass==="admin123"){
    isAdmin=true;
    document.body.classList.add('admin');
    document.getElementById('addEventBtn').style.display='block';
    document.getElementById('addShoutBtn').style.display='block';
  }else alert("Wrong password");
}

// Calendar logic
let currentYear=2025, currentMonth=8; // Sept
let events=[];
const monthNames=['January','February','March','April','May','June','July','August','September','October','November','December'];
const eventsRef=db.ref('events');
eventsRef.on('value',snap=>{ events=Object.values(snap.val()||{}); renderCalendar(); });

function renderCalendar(){
  const cal=document.getElementById('calendar'); cal.innerHTML='';
  const firstDay=new Date(currentYear,currentMonth,1).getDay();
  const daysInMonth=new Date(currentYear,currentMonth+1,0).getDate();
  for(let i=0;i<firstDay;i++) cal.appendChild(document.createElement('div'));
  for(let d=1;d<=daysInMonth;d++){
    const dayDiv=document.createElement('div'); dayDiv.className='day';
    dayDiv.innerHTML=`<div class="date">${d}</div>`;
    events.filter(e=>e.year===currentYear && e.month===currentMonth && e.day===d)
          .forEach(ev=>{
            const div=document.createElement('div'); div.className='event';
            div.textContent=ev.title+' ('+ev.unis.join(',')+')';
            if(isAdmin){
              const x=document.createElement('span'); x.textContent='×'; x.className='deleteBtn';
              x.onclick=()=>{ db.ref('events/'+ev.id).remove(); };
              div.appendChild(x);
            }
            dayDiv.appendChild(div);
          });
    cal.appendChild(dayDiv);
  }
  document.getElementById('currentMonth').textContent=monthNames[currentMonth]+' '+currentYear;
}

function prevMonth(){ currentMonth--; if(currentYear===2025 && currentMonth<8){ currentMonth=8; } else if(currentYear===2026 && currentMonth<0){ currentMonth=0; currentYear=2025; } renderCalendar(); }
function nextMonth(){ currentMonth++; if(currentYear===2025 && currentMonth>11){ currentMonth=0; currentYear=2026; } else if(currentYear===2026 && currentMonth>6){ currentMonth=6; } renderCalendar(); }
function showAddEvent(){ document.getElementById('eventForm').style.display='block'; }
function addEvent(){
  const title=document.getElementById('eventTitle').value;
  const day=parseInt(document.getElementById('eventDay').value);
  const unis=[...document.querySelectorAll('#eventForm input[type=checkbox]:checked')].map(cb=>cb.value);
  if(!title||!day||unis.length===0) return alert("Fill all fields");
  eventsRef.push({id:Date.now(),year:currentYear,month:currentMonth,day,title,unis});
  document.getElementById('eventForm').style.display='none';
}

// Shoutouts
let shoutouts=[];
const shoutoutsRef=db.ref('shoutouts');
let studentsUni={'Alice':'Oxford','Bob':'Edinburgh','Charlie':'Manchester','Diana':'Warwick'};
const uniColors={'Oxford':'blue','Edinburgh':'red','Manchester':'deeppink','Warwick':'purple'};
let uniCounts={'Oxford':0,'Edinburgh':0,'Manchester':0,'Warwick':0};

shoutoutsRef.on('value',snap=>{ shoutouts=Object.values(snap.val()||{}).sort((a,b)=>new Date(b.time)-new Date(a.time)); renderShoutouts(); updateBars(); });

function showAddShout(){ document.getElementById('shoutForm').style.display='block'; }
function addShoutout(){
  const student=document.getElementById('shoutStudent').value;
  const reason=document.getElementById('shoutReason').value;
  const initials=document.getElementById('shoutInitials').value;
  if(!student||!reason||!initials||initials.length!==3) return alert("Fill mandatory fields");
  shoutoutsRef.push({student,reason,initials,time:new Date().toISOString()});
  document.getElementById('shoutForm').style.display='none';
}

function renderShoutouts(){
  const list=document.getElementById('shoutList'); list.innerHTML='';
  shoutouts.forEach(s=>{
    const div=document.createElement('div'); div.className='shoutoutBox';
    div.textContent=`${s.student}: ${s.reason} (${s.initials}) - ${new Date(s.time).toLocaleString()}`;
    list.appendChild(div);
  });
}

function updateBars(){
  uniCounts={'Oxford':0,'Edinburgh':0,'Manchester':0,'Warwick':0};
  shoutouts.forEach(s=>{ const u=studentsUni[s.student]; if(u) uniCounts[u]++; });
  const bc=document.getElementById('barChart'); bc.innerHTML='';
  for(const uni in uniCounts){
    const bar=document.createElement('div'); bar.className='bar';
    const fill=document.createElement('div'); fill.className='barFill'; fill.style.height=(uniCounts[uni]*20)+'px'; fill.style.background=uniColors[uni];
    const label=document.createElement('div'); label.className='barLabel'; label.textContent=uni;
    bar.appendChild(fill); bar.appendChild(label); bc.appendChild(bar);
  }
}
</script>
</body>
</html>
