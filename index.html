<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ark Pioneer Sixth Form Dashboard</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { margin:0; font-family: 'Roboto', sans-serif; background-color: #f5f5f5; }
header { background-color:#001f4d; color:white; display:flex; justify-content:space-between; align-items:center; padding:10px 20px; }
header h1 { margin:0; } header h1 span { font-style: italic; }
header h2 { font-family:'Pacifico', cursive; color:pink; margin-left:10px; }
.login-btn { background-color:pink; border:none; padding:5px 15px; border-radius:5px; cursor:pointer; font-weight:bold; }
.container { display:flex; height:calc(100vh - 60px); overflow:hidden; }
.column { padding:10px; overflow-y:auto; }
.left-column { width:25%; background-color:#e6f0ff; }
.middle-column { width:45%; background-color:#ffffff; display:flex; flex-direction:column; }
.right-column { width:30%; background-color:#f0f0f0; }
h3 { text-align:center; }
.shoutouts { flex-grow:1; overflow-y:auto; }
.shoutout-box { margin:10px; padding:10px; background-color:#d4edda; border:3px solid; border-radius:8px; }
.leaderboard { display:flex; justify-content:space-around; margin-bottom:10px; background-color:#ffe6f0; padding:5px; border-radius:5px; }
button { margin:5px 0; padding:5px 10px; cursor:pointer; }
#calendar { max-width:100%; margin:0 auto; }
</style>
</head>
<body>

<header>
    <div>
        <h1>Ark Pioneer <span>Sixth Form</span></h1>
        <h2>Dashboard</h2>
    </div>
    <button class="login-btn" id="loginBtn">Login</button>
</header>

<div class="container">
    <div class="column left-column">
        <h3>Events</h3>
        <div id="calendar"></div>
        <button id="addEventBtn" style="display:none;">Add Event</button>
    </div>

    <div class="column middle-column">
        <div>
            <h3>Shoutouts</h3>
            <div class="leaderboard" id="leaderboard"></div>
            <button id="addShoutoutBtn" style="display:none;">Add Shoutout</button>
        </div>
        <div class="shoutouts" id="shoutoutsList"></div>
    </div>

    <div class="column right-column">
        <h3>University Challenge</h3>
        <canvas id="uniChart"></canvas>
        <button id="addStudentBtn" style="display:none;">Add Student</button>
    </div>
</div>

<!-- Modals -->
<div id="shoutoutModal" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:20px;border-radius:10px;box-shadow:0px 0px 10px black;">
    <h3>Add Shoutout</h3>
    <label>Awarded to:</label>
    <select id="studentSelect"></select><br><br>
    <label>Reason:</label><br>
    <textarea id="shoutoutReason" rows="3" cols="30"></textarea><br><br>
    <label>Teacher Initials (3 chars):</label>
    <input type="text" id="teacherInitials" maxlength="3"><br><br>
    <button id="submitShoutout">Submit</button>
    <button onclick="document.getElementById('shoutoutModal').style.display='none'">Cancel</button>
</div>

<div id="eventModal" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:20px;border-radius:10px;box-shadow:0px 0px 10px black;">
    <h3>Add Event</h3>
    <label>Title:</label><br>
    <input type="text" id="eventTitle"><br><br>
    <label>Date:</label><br>
    <input type="date" id="eventDate"><br><br>
    <button id="submitEvent">Submit</button>
    <button onclick="document.getElementById('eventModal').style.display='none'">Cancel</button>
</div>

<script>
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// University colors
const unis = ["Edinburgh","Manchester","Oxford","Warwick"];
const uniColors = { "Edinburgh":"#002147", "Manchester":"#D71920", "Oxford":"#002147", "Warwick":"#007B43" };

// Populate students dropdown from Firebase
const studentSelect = document.getElementById("studentSelect");
function loadStudents(){
    db.ref("students").once("value", snapshot => {
        studentSelect.innerHTML="";
        snapshot.forEach(child => {
            const s = child.val();
            const opt = document.createElement("option");
            opt.value=s.name;
            opt.innerText=`${s.name} (${s.uni})`;
            studentSelect.appendChild(opt);
        });
    });
}

// Shoutouts
function loadShoutouts(){
    db.ref("shoutouts").on("value", snapshot => {
        let shoutouts = [];
        snapshot.forEach(child=> shoutouts.push(child.val()));
        renderShoutouts(shoutouts);
    });
}

function renderShoutouts(shoutouts){
    const list = document.getElementById("shoutoutsList");
    list.innerHTML="";
    shoutouts.sort((a,b)=>b.timestamp-a.timestamp).forEach(s=>{
        const div=document.createElement("div");
        div.className="shoutout-box";
        div.style.borderColor=uniColors[s.uni];
        div.innerHTML=`<strong>${s.name}</strong> (${s.uni})<br>${s.reason}<br><em>${s.teacher}</em>`;
        list.appendChild(div);
    });
    updateLeaderboard(shoutouts);
    updateChart(shoutouts);
}

function updateLeaderboard(shoutouts){
    const leaderboard = document.getElementById("leaderboard");
    leaderboard.innerHTML="";
    let counts = {};
    shoutouts.forEach(s=> counts[s.name]=(counts[s.name]||0)+1 );
    Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,3).forEach(entry=>{
        const div = document.createElement("div");
        div.innerHTML=`${entry[0]}: ${entry[1]}`;
        leaderboard.appendChild(div);
    });
}

// Chart
const ctx = document.getElementById('uniChart').getContext('2d');
const uniChart = new Chart(ctx,{type:'bar',data:{labels:unis,datasets:[{label:'Shoutouts',data:[0,0,0,0],backgroundColor:[uniColors.Edinburgh, uniColors.Manchester, uniColors.Oxford, uniColors.Warwick]}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}});
function updateChart(shoutouts){
    let counts={Edinburgh:0,Manchester:0,Oxford:0,Warwick:0};
    shoutouts.forEach(s=>counts[s.uni]++);
    uniChart.data.datasets[0].data = unis.map(u=>counts[u]);
    uniChart.update();
}

// Add shoutout
document.getElementById("submitShoutout").onclick=function(){
    const name=studentSelect.value;
    const reason=document.getElementById("shoutoutReason").value;
    const teacher=document.getElementById("teacherInitials").value.toUpperCase();
    if(!name||!reason||teacher.length!==3){alert("Fill all fields correctly"); return;}
    const newShoutout={name:name, reason:reason, teacher:teacher, timestamp:Date.now(), uni:""};
    db.ref("students").orderByChild("name").equalTo(name).once("value",snap=>{
        snap.forEach(child=> newShoutout.uni=child.val().uni );
        db.ref("shoutouts").push(newShoutout);
        document.getElementById('shoutoutModal').style.display='none';
    });
}

// Events with Firebase
const calendarEl = document.getElementById('calendar');
const calendar = new FullCalendar.Calendar(calendarEl,{initialView:'dayGridMonth',initialDate:'2025-09-01',validRange:{start:'2025-09-01',end:'2026-07-31'},headerToolbar:{left:'prev,next today',center:'title',right:''}});
calendar.render();

db.ref("events").on("value", snapshot=>{
    calendar.removeAllEvents();
    snapshot.forEach(child=>{
        const e = child.val();
        calendar.addEvent({title:e.title,start:e.date,allDay:true});
    });
});

document.getElementById("submitEvent").onclick=function(){
    const title=document.getElementById("eventTitle").value;
    const date=document.getElementById("eventDate").value;
    if(!title||!date){alert("Fill all fields"); return;}
    db.ref("events").push({title:title,date:date});
    document.getElementById("eventModal").style.display='none';
}

// Login logic
let userRole=null;
document.getElementById("loginBtn").onclick=function(){
    const role=prompt("Enter role (admin/teacher):");
    if(role==="admin"||role==="teacher"){userRole=role; alert("Logged in as "+role); showButtons();}
    else alert("Invalid role");
}
function showButtons(){
    if(userRole==="admin"){
        document.getElementById("addEventBtn").style.display="block";
        document.getElementById("addShoutoutBtn").style.display="block";
        document.getElementById("addStudentBtn").style.display="block";
    } else if(userRole==="teacher"){
        document.getElementById("addShoutoutBtn").style.display="block";
    }
}

// Load initial data
loadStudents();
loadShoutouts();
</script>
</body>
</html>
