<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ark Pioneer Sixth Form Dashboard</title>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>

<!-- Firebase Config -->
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAbge0io2zDFsgPTgyJ8cgzfGsegqeF19w",
  authDomain: "piosf-7ab81.firebaseapp.com",
  databaseURL: "https://piosf-7ab81-default-rtdb.firebaseio.com",
  projectId: "piosf-7ab81",
  storageBucket: "piosf-7ab81.firebasestorage.app",
  messagingSenderId: "198847746183",
  appId: "1:198847746183:web:bbb2ab9f9c4f3657ea6822"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>

<style>
body { font-family: Arial, sans-serif; margin: 0; background: #f4f4f4; }
/* Banner */
header {
  position: fixed; top: 0; left: 0; right: 0;
  background: #222; padding: 12px; text-align: center;
  z-index: 1000;
}
header span { color: white; font-size: 20px; }
header .sixth { font-weight: bold; font-style: italic; }
header .dashboard-text { color: orange; }
/* Main content */
main { margin-top: 80px; padding: 20px; }
/* Login */
#loginBox { margin: 10px 0; }
/* Calendar */
.calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
.day { background: white; padding: 10px; position: relative; min-height: 80px; }
.day .date { font-weight: bold; }
.event { padding: 2px 4px; border-radius: 4px; margin: 2px 0; color: white; font-size: 12px; position: relative; }
.event .deleteBtn { position: absolute; right: 2px; top: 2px; cursor: pointer; font-weight: bold; display: none; }
.admin .event .deleteBtn { display: inline; }
/* Shoutouts */
#shoutouts { margin-top: 20px; }
/* Uni Bar Chart */
.barChart { display: flex; align-items: flex-end; height: 300px; gap: 20px; margin-top: 20px; }
.bar { flex: 1; display: flex; align-items: flex-end; justify-content: center; position: relative; }
.bar div { width: 60px; text-align: center; font-weight: bold; writing-mode: vertical-rl; transform: rotate(180deg); position: absolute; bottom: 0; }
.barFill { width: 60px; }
</style>
</head>

<body>
<header>
  <span class="ark">Ark Pioneer </span>
  <span class="sixth">Sixth Form</span>
  <span class="dashboard-text"> Dashboard</span>
</header>

<main>
<div id="loginBox">
  <input type="password" id="adminPass" placeholder="Enter admin password">
  <button onclick="login()">Login</button>
</div>

<h2>Calendar - September 2025</h2>
<div id="calendar" class="calendar"></div>
<button onclick="showAddEvent()">Add Event</button>
<div id="eventForm" style="display:none; margin-top:10px;">
  <input type="text" id="eventTitle" placeholder="Event title">
  <input type="number" id="eventDay" min="1" max="30" placeholder="Day">
  <div>
    <label><input type="checkbox" value="Oxford">Oxford</label>
    <label><input type="checkbox" value="Cambridge">Cambridge</label>
    <label><input type="checkbox" value="UCL">UCL</label>
    <label><input type="checkbox" value="Manchester">Manchester</label>
  </div>
  <button onclick="addEvent()">Save</button>
</div>

<div id="shoutouts">
  <h2>Shoutouts</h2>
  <input type="text" id="shoutInput" placeholder="Write shoutout...">
  <button onclick="addShoutout()">Add</button>
  <ul id="shoutList"></ul>
</div>

<h2>University Applications</h2>
<div class="barChart" id="barChart"></div>
</main>

<script>
// Dashboard logic
let isAdmin = false;
const uniColors = { Oxford: 'blue', Cambridge: 'green', UCL: 'purple', Manchester: 'deeppink' };

function login() {
  const pass = document.getElementById('adminPass').value;
  if(pass==='admin123'){
    isAdmin = true;
    document.body.classList.add('admin');
    document.getElementById('loginBox').style.display='none';
    alert('Admin logged in!');
  } else alert('Wrong password');
}

// --- SHOUTOUTS ---
function addShoutout(){
  const s = document.getElementById('shoutInput').value.trim();
  if(!s) return;
  db.ref('shoutouts').push({text:s, timestamp:Date.now()});
  document.getElementById('shoutInput').value='';
}

function renderShoutouts(){
  const list=document.getElementById('shoutList');
  db.ref('shoutouts').on('value', snapshot=>{
    list.innerHTML='';
    const data=snapshot.val();
    if(!data) return;
    Object.values(data).forEach(s=>{
      const li=document.createElement('li'); li.textContent=s.text;
      list.appendChild(li);
    });
  });
}

// --- EVENTS ---
function showAddEvent(){ document.getElementById('eventForm').style.display='block'; }

function addEvent(){
  const title = document.getElementById('eventTitle').value.trim();
  const day = parseInt(document.getElementById('eventDay').value);
  const uniBoxes = [...document.querySelectorAll('#eventForm input[type=checkbox]:checked')];
  const unis = uniBoxes.map(cb=>cb.value);
  if(!title || !day || unis.length===0) return alert('Fill all fields');
  db.ref('events').push({day,title,unis});
  document.getElementById('eventTitle').value='';
  document.getElementById('eventDay').value='';
  document.querySelectorAll('#eventForm input[type=checkbox]').forEach(cb=>cb.checked=false);
}

function renderCalendar(){
  const cal=document.getElementById('calendar');
  db.ref('events').on('value', snapshot=>{
    cal.innerHTML='';
    const data=snapshot.val();
    for(let i=1;i<=30;i++){
      const d=document.createElement('div'); d.className='day';
      d.innerHTML=`<div class="date">${i}</div>`;
      if(data){
        Object.entries(data).forEach(([id,e])=>{
          if(e.day===i){
            e.unis.forEach(u=>{
              const ev=document.createElement('div'); ev.className='event';
              ev.style.background=uniColors[u]; ev.textContent=e.title+' ('+u+')';
              if(isAdmin){
                const x=document.createElement('span'); x.textContent='Ã—';
                x.className='deleteBtn';
                x.onclick=()=>{ db.ref('events/'+id).remove(); };
                ev.appendChild(x);
              }
              d.appendChild(ev);
            });
          }
        });
      }
      cal.appendChild(d);
    }
  });
}

// --- UNI BAR CHART ---
function renderBars(){
  const bc=document.getElementById('barChart');
  db.ref('shoutouts').on('value', snapshot=>{
    const data=snapshot.val(); let counts={Oxford:0,Cambridge:0,UCL:0,Manchester:0};
    if(data){
      Object.values(data).forEach(s=>{
        // For demo, assign to a random uni (or store uni with shoutout in DB)
        const uniKeys=Object.keys(counts);
        const uni=uniKeys[Math.floor(Math.random()*uniKeys.length)];
        counts[uni]++;
      });
    }
    bc.innerHTML='';
    for(const uni in counts){
      const bar=document.createElement('div'); bar.className='bar';
      const fill=document.createElement('div'); fill.className='barFill';
      fill.style.height=(counts[uni]*40)+'px'; fill.style.background=uniColors[uni];
      const label=document.createElement('div'); label.textContent=uni; label.style.color='white';
      bar.appendChild(fill); bar.appendChild(label); bc.appendChild(bar);
    }
  });
}

// Initialize renders
renderShoutouts();
renderCalendar();
renderBars();
</script>
</body>
</html>
